<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<!-- prims plugin styles -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/autolinker/prism-autolinker.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/command-line/prism-command-line.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet">
<!-- ajax -->
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism-tomorrow.min.css'>

<title>copy constructor</title>
<style>
a,
a:hover,
a:focus {
	text-decoration: none;
}

.pager .top {
	float: center;
}

.dark-mode {
	background-color: black;
	color: #aaaaaa;
}

.dark-mode a {
	color: royalblue;
}

.dark-mode .page-link {
	color: #bdc0c4;
	background-color: #212529;
	border: 1px solid #616161;
}

.dark-mode .page-link .disabled li > a {
	color: #bdc0c4;
	background-color: #212529;
	border: 1px solid #616161;
}

.dark-mode .pager li > a,
.dark-mode .pager li > span {
	color: #bdc0c4;
	background-color: #212529;
	border: 1px solid #616161;
}

.dark-mode .pager li > a:hover,
.dark-mode .pager li > a:focus,
.dark-mode .pager li > span:hover {
	background-color: #555555;
	color: #bdc0c4;
}

.dark-mode .pager .disabled a,
.dark-mode .pager .disabled a:hover,
.dark-mode .pager .disabled a:focus {
	color: #6c757d;
	background-color: #212529;
	border: 1px solid #616161;
}

.dark-mode .breadcrumb {
	background-color: #212529;
}

.dark-mode .breadcrumb a {
	color: #bdc0c4;
}

.dark-mode .breadcrumb a:hover,
.dark-mode .breadcrumb a:focus {
	text-decoration: none;
	color: #777777;
}

.breadcrumb a,
.breadcrumb a:hover,
.breadcrumb a:focus {
	text-decoration: none;
}

/* prism overrides */
div.code-toolbar>.toolbar a,
div.code-toolbar>.toolbar button,
div.code-toolbar>.toolbar span {
	margin-left: 0.7rem;
}

pre {
	margin-bottom: 1.3rem !important;
}

.breadcrumb-item+.breadcrumb-item::before {
	content: '> ';
}

</style>
</head>
<body class="container">
<ol class="breadcrumb">
<li class="breadcrumb-item"><a title="Shortcut: ALT + SHIFT + 1" accesskey="1" href="/">Home</a></li>
<li class="breadcrumb-item"><a title="Shortcut: ALT + SHIFT + 2" accesskey="2" href="/6.0.html">C++</a></li>
<li class="breadcrumb-item"><a title="Shortcut: ALT + SHIFT + 3" accesskey="3" href="/6.2.0.html">Object Orientation</a></li>
<li class="breadcrumb-item"><a title="Shortcut: ALT + SHIFT + 4" accesskey="4" href="/6.2.1.0.html">Classes and Objects</a></li>
<li class="breadcrumb-item active" >copy constructor</li>
</ol>
<h2>copy constructor</h2>
<div class="comment-style" >
When you pass a variable by value to a function, that function will copy that value and assigns that to its parameter.<br />
That is, after invoking that function, you will have two of those values on memory.<br />
This also happens when you pass an object to a function by values.<br />
Classes do not have any idea how to copy their members into new location by themselves. So that's out job to make sure an object will be copied properly when it's passed to a function.<br />
<br />
Copy constructors are declared just like default constructors except that they have a reference of the object as their parameters with no return value.<br />
<br />
ref[6]
When a class performs memory allocation using new, care must be taken to avoid
a number of common programming errors.<br />
A somewhat more insidious problem occurs when classes that allocate memory fail
to provide a copy constructor or an assignment operator.<br />
Consider the following example, using our Vect class:<br />
<br />
```cxx
Vect a(100);<br />
Vect b = a;<br />
Vect c;<br />
c = a;<br />
```
<br />
It would seem that we have just created three separate vectors, all of size 100,<br />
but have we?<br />
In reality all three of these vectors share the same 100-element array.<br />
Let us see why this has occurred.<br />
<br />
The declaration of object a invokes the vector constructor, which allocates an
array of 100 integers and a.data points to this array. The declaration “Vect b=a”
initializes b from a. Since we provided no copy constructor in Vect, the system
uses its default, which simply copies each member of a to b. In particular it sets
“b.data=a.data.” Notice that this does not copy the contents of the array; rather it
copies the pointer to the array’s initial element. This default action is sometimes
called a shallow copy.<br />
<br />
The declaration of c invokes the constructor with a default argument value of
10, and hence allocates an array of 10 elements in the free store. Because we have
not provided an assignment operator, the statement “c=a,” also does a shallow copy
of a to c. Only pointers are copied, not array contents. Worse yet, we have lost the
pointer to c’s original 10-element array, thus creating a memory leak.<br />
<br />
Now, a, b, and c all have members that point to the same array in the free store.<br />
If the contents of the arrays of one of the three were to change, the other two would
mysteriously change as well. Worse yet, if one of the three were to be deleted
before the others (for example, if this variable was declared in a nested block), the
destructor would delete the shared array. When either of the other two attempts to
access the now deleted array, the results would be disastrous. In short, there are
many problems here.<br />
<br />
Fortunately, there is a simple fix for all of these problems. The problems arose
because we allocated memory and we used the system’s default copy constructor
and assignment operator. If a class allocates memory, you should provide a copy
constructor and assignment operator to allocate new memory for making copies.<br />
end[6]
</div>
<hr />
<h3>Source</h3>
  <cite>copy_constructor.cxx</cite>
<pre class="line-numbers" >
<code class="language-cpp">
    #include &lt;iostream&gt;
    #include &lt;string&gt;
    #include &lt;cstring&gt;
    
    class Message {
    private:
        char* message;
    
    public:
        Message(const char* raw) {
            std::cout &lt;&lt; &quot;constructor invoked&quot; &lt;&lt; std::endl;
            message = NULL;
    
            if (raw != NULL) {
                message = new char[strlen(raw)+1];
                strcpy(message, raw);
    
                std::cout &lt;&lt; &quot;message is at address: &quot; &lt;&lt; std::hex &lt;&lt; &amp;message &lt;&lt; std::endl;
            }
        }
    
        Message(const Message&amp; cpymsg) {
            std::cout &lt;&lt; &quot;copy constructor invoked&quot; &lt;&lt; std::endl;
            message = NULL;
    
            if (cpymsg.message != NULL) {
                message = new char[strlen(cpymsg.message)+1];
                strcpy(message, cpymsg.message);
    
                std::cout &lt;&lt; &quot;copied message is at address: &quot; &lt;&lt; std::hex &lt;&lt; &amp;message &lt;&lt; std::endl;
            }
        }
    
        void show() {
            std::cout &lt;&lt; &quot;message text: &quot;;
            std::cout &lt;&lt; message &lt;&lt; std::endl;
        }
    
        void length() {
            std::cout &lt;&lt; &quot;message length: &quot;;
            std::cout &lt;&lt; std::dec &lt;&lt; strlen(message) &lt;&lt; std::endl;
        }
    
        // destructor
        ~Message() {
            std::cout &lt;&lt; &quot;destructor invoked&quot; &lt;&lt; std::endl;
            delete [] message;
        }
    };
    
    // copy of object pointer
    void get_info(Message raw) {
        raw.length();
        raw.show();
    }
    
    int main()
    {
        Message msg(&quot;Cxx Programming&quot;);
        get_info(msg);
    
        return 0;
    }
</code>
</pre>
<ul class="pager">
<li class="previous"><a title="Shortcut: ALT + SHIFT + B" accesskey="B" href="/6.2.1.5.html">previous page</a></li>
<li class="top"><a title="Shortcut: ALT + SHIFT + T" accesskey="T" href="/">top page</a></li>
<li class="next"><a title="Shortcut: ALT + SHIFT + F" accesskey="F" href="/6.2.1.7.html">next page</a></li>
</ul>
<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<!-- bootstrap -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<!-- prism js -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/prism.min.js'></script>
<!-- prism languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-c.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-cpp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-bash.min.js"></script>
<!-- prism plugins -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/toolbar/prism-toolbar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/autolinker/prism-autolinker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/command-line/prism-command-line.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/remove-initial-line-feed/prism-remove-initial-line-feed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/show-language/prism-show-language.min.js"></script>
<script>
$(function() {
  $('.list-group-item').on('click', function() {
    $('.glyphicon', this)
      .toggleClass('glyphicon-chevron-right')
      .toggleClass('glyphicon-chevron-down');
  });
});
</script>
<script>
function darkmode(manual) {
	const hours = new Date().getHours();
	const isNight = !(hours > 6 && hours < 20);
	var bodystyle = document.body;
	if (isNight || manual) {
		bodystyle.classList.add("dark-mode");
	} else {
		bodystyle.classList.remove("dark-mode");
	}
}
darkmode();
</script>
</body>
</html>
